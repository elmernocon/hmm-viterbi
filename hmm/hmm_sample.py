import numpy as np
from hmm.hmm_jhu import HMM


def create_hmm_cpg_islands():

    hmm_cpg_islands = HMM(
        # States
        # 0 : Begin/End
        # A : A+
        # C : C+
        # G : G+
        # T : T+
        # B : A-
        # D : C-
        # H : G-
        # U : T-
        # Symbols
        # a
        # c
        # g
        # t
        # Transition Matrix
        {
            "00": 0.0000000,
            "0A": 0.0725193,
            "0C": 0.1637630,
            "0G": 0.1788242,
            "0T": 0.0754545,
            "0B": 0.1322050,
            "0D": 0.1267006,
            "0H": 0.1226380,
            "0U": 0.1278950,
            "A0": 0.0010000,
            "AA": 0.1762237,
            "AC": 0.2682517,
            "AG": 0.4170629,
            "AT": 0.1174825,
            "AB": 0.0035964,
            "AD": 0.0054745,
            "AH": 0.0085104,
            "AU": 0.0023976,
            "C0": 0.0010000,
            "CA": 0.1672435,
            "CC": 0.3599201,
            "CG": 0.2679840,
            "CT": 0.1838722,
            "CB": 0.0034131,
            "CD": 0.0073453,
            "CH": 0.0054690,
            "CU": 0.0037524,
            "G0": 0.0010000,
            "GA": 0.1576223,
            "GC": 0.3318881,
            "GG": 0.3671328,
            "GT": 0.1223776,
            "GB": 0.0032167,
            "GD": 0.0067732,
            "GH": 0.0074915,
            "GU": 0.0024975,
            "T0": 0.0010000,
            "TA": 0.0773426,
            "TC": 0.3475514,
            "TG": 0.3759440,
            "TT": 0.1781818,
            "TB": 0.0015784,
            "TD": 0.0070929,
            "TH": 0.0076723,
            "TU": 0.0036363,
            "B0": 0.0010000,
            "BA": 0.0002997,
            "BC": 0.0002047,
            "BG": 0.0002837,
            "BT": 0.0002097,
            "BB": 0.2994005,
            "BD": 0.2045904,
            "BH": 0.2844305,
            "BU": 0.2095804,
            "D0": 0.0010000,
            "DA": 0.0003216,
            "DC": 0.0002977,
            "DG": 0.0000769,
            "DT": 0.0003016,
            "DB": 0.3213566,
            "DD": 0.2974045,
            "DH": 0.0778441,
            "DU": 0.3013966,
            "H0": 0.0010000,
            "HA": 0.0001768,
            "HC": 0.0002387,
            "HG": 0.0002917,
            "HT": 0.0002917,
            "HB": 0.1766463,
            "HD": 0.2385224,
            "HH": 0.2914165,
            "HU": 0.2914155,
            "U0": 0.0010000,
            "UA": 0.0002477,
            "UC": 0.0002457,
            "UG": 0.0002977,
            "UT": 0.0002077,
            "UB": 0.2475044,
            "UD": 0.2455084,
            "UH": 0.2974035,
            "UU": 0.2075844,
        },
        # Emission Matrix
        {
            "0a": 0.0,
            "0c": 0.0,
            "0g": 0.0,
            "0t": 0.0,
            "Aa": 1.0,
            "Ac": 0.0,
            "Ag": 0.0,
            "At": 0.0,
            "Ca": 0.0,
            "Cc": 1.0,
            "Cg": 0.0,
            "Ct": 0.0,
            "Ga": 0.0,
            "Gc": 0.0,
            "Gg": 1.0,
            "Gt": 0.0,
            "Ta": 0.0,
            "Tc": 0.0,
            "Tg": 0.0,
            "Tt": 1.0,
            "Ba": 1.0,
            "Bc": 0.0,
            "Bg": 0.0,
            "Bt": 0.0,
            "Da": 0.0,
            "Dc": 1.0,
            "Dg": 0.0,
            "Dt": 0.0,
            "Ha": 0.0,
            "Hc": 0.0,
            "Hg": 1.0,
            "Ht": 0.0,
            "Ua": 0.0,
            "Uc": 0.0,
            "Ug": 0.0,
            "Ut": 1.0,
        },
        # Initial Probabilities
        {
            "0": 1.0,
            "A": 0.0000001,
            "C": 0.0000001,
            "G": 0.0000001,
            "T": 0.0000001,
            "B": 0.0000001,
            "D": 0.0000001,
            "H": 0.0000001,
            "U": 0.0000001,
        },
    )

    return hmm_cpg_islands


if __name__ == "__main__":

    np.seterr(divide="ignore", invalid="ignore")

    hmm = create_hmm_cpg_islands()

    observation = "actgctacgtacgtacgtactag"

    score, path = hmm.viterbi_log(observation)

    print(f"Score: {score}\n" f"Path: {path}\n" f"Observation: {observation}")
